<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Tesla Super Charger Network</title>

<style>

.graticule {
  fill: none;
  stroke: #777;
  stroke-width: .5px;
  stroke-opacity: .5;
}

.land {
  fill: steelblue
}

.boundary {
  fill: none;
  stroke: #fff;
  stroke-width: .5px;
}

</style>
<body>
  <p>
    <label for="nNode" 
           style="display: inline-block; width: 240px; text-align: right">
           Super Charger Count = <span id="nNode-value">â€¦</span>
    </label>
    <input type="range" min="1" max="150" id="nNode">
  </p>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71787228-2', 'auto');
  ga('send', 'pageview');

</script>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script>
//initial page load call
function draw(network_data){

    //page update function called after any changes
  var width = 1300,
      height = 600;

  var projection = d3.geo.mercator()
      .center([70, 48])
      .scale(650)
      .rotate([-180,0]);

  var path = d3.geo.path()
      .projection(projection);

  var graticule = d3.geo.graticule();

  var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height);

  svg.append("path")
      .datum(graticule)
      .attr("class", "graticule")
      .attr("d", path);

  d3.select("#nNode")
  .attr("max",network_data["nodes"].length)
  .attr("value",network_data["nodes"].length)
  .on("input", function() {
    update(+this.value);
  });

    function update(input_node){
      input_node = +input_node // convert string input to int for equality evaluations

      d3.selectAll(".connection").remove();

      var connection = svg.selectAll(".connection")
      .data(network_data['links'])
      .enter().append("g")
      .attr("class","connection")
      .filter(function(d) { return +d.second_node <= input_node; })
      .append("line")
      .attr("class","link")
      .style("stroke","black")
      .attr("x1", function(d){return projection(d['lon_lat_1'])[0]})
      .attr("y1", function(d){return projection(d['lon_lat_1'])[1]})
      .attr("x2", function(d){return projection(d['lon_lat_2'])[0]})
      .attr("y2", function(d){return projection(d['lon_lat_2'])[1]})

      // connection.exit().remove();

      d3.selectAll(".node").remove();

      var node = svg.selectAll(".node")
      .data(network_data['nodes'], function(d){ return d.SC_index})
      .enter().append("g")
      .attr("class","node")
      .filter(function(d) { return +d.SC_index <= input_node; })
      .append("circle")
      .attr("class","SC")
      .attr("cx", function (d) {return projection(d['GPS_lon_lat'])[0]; })
      .attr("cy", function (d) {return projection(d['GPS_lon_lat'])[1]; })
      .attr("r", "2px")
      .attr("fill", "red")

      d3.select("#nNode-value").text(input_node);
    }

  //build discipline selection pane
  function draw_world(error, world) {
    if (error) throw error;

    svg.insert("path", ".graticule")
        .datum(topojson.feature(world, world.objects.land))
        .attr("class", "land")
        .attr("d", path);

    svg.insert("path", ".graticule")
        .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))
        .attr("class", "boundary")
        .attr("d", path);
    }

    d3.json("Final Project/world.json", draw_world)
    //initial draw call on page load
    update(network_data["nodes"].length)
  };
d3.json("Final Project/network.json", draw)
</script>
</body>